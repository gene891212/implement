<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/element-plus/dist/index.css" />
    <!-- Import Vue 3 -->
    <script src="https://cdn.jsdelivr.net/npm/vue@next"></script>
    <!-- Import component library -->
    <script src="https://cdn.jsdelivr.net/npm/element-plus"></script>
    <!-- Import MQTT.js -->
    <script src="https://unpkg.com/mqtt@4.3.2/dist/mqtt.min.js"></script>

    <style>
        .container {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .el-header {
            text-align: center;
            color: var(--el-text-color-primary);
            line-height: 60px;
        }

        .text {
            font-size: 14px;
        }

        .item {
            margin-bottom: 18px;
        }

        .box-card {
            max-width: 480px;
        }
    </style>
    <title>Document</title>
</head>

<body>
    <div id="app">
        <el-container>
            <el-header>
                <span>Card name</span>
            </el-header>
            <el-row justify="center">
                <el-col :xs="23" :sm="16" :md="16">
                    <el-row>
                        <el-col :span="12">
                            <el-card>
                                <template #header>
                                    <div class="card-header">
                                        <span>Oxygen Saturation(%)</span>
                                    </div>
                                </template>
                                <el-row justify="center">
                                    <el-progress type="dashboard" :percentage="percentage" :color="colors" />
                                </el-row>
                            </el-card>
                        </el-col>
                        <el-col :span="12">
                            <el-card>
                                <template #header>
                                    <div class="card-header">
                                        <span>Card name</span>
                                    </div>
                                </template>
                            </el-card>
                        </el-col>
                    </el-row>
                </el-col>
            </el-row>
        </el-container>
    </div>

    <script>
        const App = {
            created() {

            },
            mounted() {
                const client = mqtt.connect("ws://192.168.0.200:9001") // you add a ws:// url here
                client.on('connect', function () {
                    client.subscribe('test', function (err) {
                        if (!err) {
                            client.publish('test', 'Hello mqtt')
                        }
                    })
                })

                // client.on('message', function (topic, message) {
                //     // message is Buffer
                //     console.log(message.toString())
                //     this.percentage = message
                //     // client.end()
                // })
                client.on('message', (topic, message) => {
                    // message is Buffer
                    console.log(message.toString())
                    this.percentage = parseFloat(message.toString())
                    // client.end()
                })
            },
            data() {
                return {
                    counter: 0,
                    percentage: 0,
                    colors: [
                        { color: '#f56c6c', percentage: 20 },
                        { color: '#e6a23c', percentage: 40 },
                        { color: '#5cb87a', percentage: 60 },
                        { color: '#1989fa', percentage: 80 },
                        { color: '#6f7ad3', percentage: 100 },
                    ]
                }
            },
            methods: {
            }
        }
        const app = Vue.createApp(App)
        app.use(ElementPlus)
        app.mount('#app')
    </script>
</body>

</html>